<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LedgerX - Enterprise Invoice Intelligence Platform</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="login-backdrop">
        <div class="login-modal">
            <h2 style="margin-bottom: 8px; color: var(--primary);">
                <i class="fas fa-lock"></i> Login Required
            </h2>
            <p style="color: var(--text-muted); margin-bottom: 24px;">Sign in to access LedgerX</p>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Username</label>
                <input type="text" id="loginUsername" placeholder="admin" 
                    style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 16px;"
                    onkeypress="if(event.key==='Enter') document.getElementById('loginPassword').focus()">
            </div>
            
            <div style="margin-bottom: 24px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Password</label>
                <input type="password" id="loginPassword" placeholder="admin123" 
                    style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 16px;"
                    onkeypress="if(event.key==='Enter') attemptLogin()">
            </div>
            
            <div id="loginError" class="login-error"></div>
            
            <button onclick="attemptLogin()" class="btn btn-primary" style="width: 100%; padding: 14px; font-size: 16px; margin-bottom: 16px;">
                <i class="fas fa-sign-in-alt"></i> Sign In
            </button>
            
            <div style="padding: 16px; background: var(--bg-main); border-radius: 8px; font-size: 13px; color: var(--text-muted);">
                <strong style="display: block; margin-bottom: 8px;">Test Credentials:</strong>
                Username: <code style="background: white; padding: 2px 6px; border-radius: 4px;">admin</code> 
                Password: <code style="background: white; padding: 2px 6px; border-radius: 4px;">admin123</code><br>
                <small>Or: john_doe / password123</small>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <i class="fas fa-microchip"></i> LedgerX
            </div>
            
            <nav>
                <div class="nav-item active" data-page="overview">
                    <i class="fas fa-chart-line"></i><span>Overview</span>
                </div>
                <div class="nav-item" data-page="upload">
                    <i class="fas fa-upload"></i><span>Upload Invoice</span>
                </div>
                <div class="nav-item" data-page="history">
                    <i class="fas fa-history"></i><span>Invoice History</span>
                </div>
                <div class="nav-item" data-page="analytics">
                    <i class="fas fa-chart-bar"></i><span>Analytics</span>
                </div>
                <div class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i><span>Settings</span>
                </div>
                <div class="nav-item" data-page="billing">
                    <i class="fas fa-dollar-sign"></i><span>Billing & Usage</span>
                </div>
            </nav>

            <div style="margin-top: auto; padding-top: 32px; border-top: 1px solid rgba(255,255,255,0.1);">
                <div id="connectionStatus" class="status-indicator">
                    <div class="status-dot"></div>
                    <span>Connecting...</span>
                </div>
                <div style="margin-top: 16px; font-size: 12px; color: rgba(255,255,255,0.5);">
                    <div>Version 2.2.0</div>
                    <div id="userInfo">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main">
            <!-- Overview Page -->
            <div id="overview" class="page active">
                <h1 class="page-title">Dashboard Overview</h1>
                <p class="page-subtitle">Real-time intelligence for your invoice processing</p>
                
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-label">Total Invoices</div>
                            <div class="kpi-icon blue"><i class="fas fa-file-invoice"></i></div>
                        </div>
                        <div class="kpi-value" id="kpiTotalInvoices">0</div>
                        <div class="kpi-trend up"><i class="fas fa-arrow-up"></i> +12% month</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-label">Avg Quality</div>
                            <div class="kpi-icon green"><i class="fas fa-check-circle"></i></div>
                        </div>
                        <div class="kpi-value" id="avgQuality">-</div>
                        <div class="kpi-trend"><i class="fas fa-star"></i> Average</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-label">Avg Risk</div>
                            <div class="kpi-icon orange"><i class="fas fa-exclamation-triangle"></i></div>
                        </div>
                        <div class="kpi-value" id="avgRisk">-</div>
                        <div class="kpi-trend"><i class="fas fa-shield-alt"></i> Average</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-label">Processed Today</div>
                            <div class="kpi-icon blue"><i class="fas fa-calendar-day"></i></div>
                        </div>
                        <div class="kpi-value" id="todayCount">0</div>
                        <div class="kpi-trend"><i class="fas fa-clock"></i> Last 24h</div>
                    </div>
                </div>
                
                <div class="table-box">
                    <div class="table-head">
                        <h3 class="table-title">Recent Activity</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Invoice</th>
                                <th>Vendor</th>
                                <th>Amount</th>
                                <th>Quality</th>
                                <th>Risk</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivity">
                            <tr>
                                <td colspan="6" class="empty-state">
                                    <div class="empty-icon"><i class="fas fa-inbox"></i></div>
                                    <div>No invoices yet</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Upload Page -->
            <div id="upload" class="page">
                <h1 class="page-title">Upload Invoice</h1>
                <p class="page-subtitle">AI-powered extraction and validation</p>
                
                <div class="upload-zone" id="uploadZone">
                    <input type="file" id="fileInput" accept=".jpg,.jpeg,.png,.pdf" style="display:none" multiple>
                    <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                    <div class="upload-text">Drop files here or click to upload</div>
                    <div class="upload-subtext">Auto-extraction with OCR • Instant ML processing</div>
                    <div class="file-formats">
                        <span class="format-badge"><i class="fas fa-file-image"></i> JPG/PNG</span>
                        <span class="format-badge"><i class="fas fa-file-pdf"></i> PDF</span>
                    </div>
                </div>
                <div id="processingQueue"></div>
            </div>

            <!-- History Page -->
            <div id="history" class="page">
                <h1 class="page-title">Invoice History</h1>
                <p class="page-subtitle">Complete history of all processed invoices</p>
                
                <div class="table-box">
                    <div class="table-head">
                        <h3 class="table-title">All Invoices</h3>
                        <button class="btn btn-secondary" onclick="exportHistory()">
                            <i class="fas fa-download"></i> Export CSV
                        </button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>File</th>
                                <th>Vendor</th>
                                <th>Amount</th>
                                <th>Quality</th>
                                <th>Risk</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="historyTable">
                            <tr>
                                <td colspan="7" class="empty-state">
                                    <div class="empty-icon"><i class="fas fa-folder-open"></i></div>
                                    <div>No history yet</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analytics" class="page">
                <h1 class="page-title">Analytics</h1>
                <p class="page-subtitle">Model performance and insights</p>
                
                <div class="kpi-grid">
                    <div class="card">
                        <div class="card-label">Quality Model F1</div>
                        <div class="kpi-value" style="color: var(--success)">77.1%</div>
                        <div class="kpi-trend"><i class="fas fa-trophy"></i> CatBoost</div>
                    </div>
                    <div class="card">
                        <div class="card-label">Failure Model F1</div>
                        <div class="kpi-value" style="color: var(--success)">70.9%</div>
                        <div class="kpi-trend"><i class="fas fa-trophy"></i> CatBoost</div>
                    </div>
                    <div class="card">
                        <div class="card-label">Avg Latency</div>
                        <div class="kpi-value">850ms</div>
                        <div class="kpi-trend"><i class="fas fa-bolt"></i> p95</div>
                    </div>
                    <div class="card">
                        <div class="card-label">Cache Hit Rate</div>
                        <div class="kpi-value" id="cacheHitRate">-</div>
                        <div class="kpi-trend"><i class="fas fa-database"></i> Optimized</div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 24px; font-size: 18px; font-weight: 700;">
                        <i class="fas fa-brain"></i> Model Performance Metrics
                    </h3>
                    <table style="width: 100%;">
                        <thead>
                            <tr style="background: var(--bg-main);">
                                <th style="padding: 12px;">Model</th>
                                <th style="padding: 12px;">Task</th>
                                <th style="padding: 12px;">F1 Score</th>
                                <th style="padding: 12px;">Accuracy</th>
                                <th style="padding: 12px;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 12px;"><strong>CatBoost</strong></td>
                                <td style="padding: 12px;">Quality Assessment</td>
                                <td style="padding: 12px; font-weight: 700; color: var(--success);">77.1%</td>
                                <td style="padding: 12px;">77.5%</td>
                                <td style="padding: 12px;"><span class="badge badge-success">Production</span></td>
                            </tr>
                            <tr>
                                <td style="padding: 12px;"><strong>CatBoost</strong></td>
                                <td style="padding: 12px;">Failure Prediction</td>
                                <td style="padding: 12px; font-weight: 700; color: var(--success);">70.9%</td>
                                <td style="padding: 12px;">71.2%</td>
                                <td style="padding: 12px;"><span class="badge badge-success">Production</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page">
                <h1 class="page-title">Settings</h1>
                <p class="page-subtitle">Configure your LedgerX instance</p>
                
                <div class="card">
                    <h3 style="margin-bottom: 24px; font-size: 18px; font-weight: 700;">
                        <i class="fas fa-server"></i> API Configuration
                    </h3>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">API Endpoint</label>
                        <input type="text" id="apiUrlSetting" value="https://ledgerx-api-671429123152.us-central1.run.app" 
                            style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 15px;">
                    </div>
                    <button class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>

                <!-- Document AI Usage Card -->
                <div class="card" style="margin-top: 24px;">
                    <h3 style="margin-bottom: 24px; font-size: 18px; font-weight: 700;">
                        <i class="fas fa-chart-bar"></i> Document AI Usage This Month
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div style="text-align: center; padding: 20px; background: var(--bg-main); border-radius: 10px;">
                            <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 8px;">Pages Used</div>
                            <div style="font-size: 32px; font-weight: 800; color: var(--warning);" id="settingsDocAiUsed">0</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: var(--bg-main); border-radius: 10px;">
                            <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 8px;">Free Tier Limit</div>
                            <div style="font-size: 32px; font-weight: 800; color: var(--primary);">1,000</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: var(--bg-main); border-radius: 10px;">
                            <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 8px;">Remaining</div>
                            <div style="font-size: 32px; font-weight: 800; color: var(--success);" id="settingsDocAiRemaining">1,000</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 600;">Quota Usage</span>
                            <span id="settingsDocAiPercent" style="font-weight: 600; color: var(--success);">0%</span>
                        </div>
                        <div style="height: 12px; background: #E5E7EB; border-radius: 6px; overflow: hidden;">
                            <div id="settingsDocAiBar" style="height: 100%; background: var(--success); width: 0%; transition: width 0.3s;"></div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="refreshDocAIUsage()" style="width: 100%;">
                        <i class="fas fa-sync-alt"></i> Refresh Usage
                    </button>
                    
                    <div style="margin-top: 16px; padding: 14px; background: #F0F9FF; border-radius: 8px; font-size: 13px; color: var(--text-muted);">
                        <strong>Cost:</strong> $0.0015 per page • First 1,000 pages/month FREE • Resets monthly
                    </div>
                </div>

                <!-- Data Management -->
                <div class="card" style="margin-top: 24px;">
                    <h3 style="margin-bottom: 24px; font-size: 18px; font-weight: 700;">Data Management</h3>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-secondary" onclick="exportAllData()">
                            <i class="fas fa-download"></i> Export All Data
                        </button>
                        <button class="btn btn-secondary" onclick="clearAllData()">
                            <i class="fas fa-trash"></i> Clear History
                        </button>
                    </div>
                </div>
            </div>

            <!-- Billing Page -->
            <div id="billing" class="page">
                <h1 class="page-title">Billing & Usage</h1>
                <p class="page-subtitle">Real-time cost monitoring and optimization</p>
                
                <!-- GCP Credits Card -->
                <div class="card">
                    <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                        <i class="fas fa-google" style="color: #4285F4; font-size: 24px;"></i> 
                        GCP Free Credits Status
                    </h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        <div style="padding: 24px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(102,126,234,0.3);">
                            <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px;">Total Credits</div>
                            <div style="font-size: 36px; font-weight: 900;">$300</div>
                            <div style="font-size: 12px; opacity: 0.8;">90-day trial</div>
                        </div>
                        <div style="padding: 24px; background: linear-gradient(135deg, #f093fb, #f5576c); border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(245,87,108,0.3);">
                            <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px;">Used</div>
                            <div style="font-size: 36px; font-weight: 900;" id="creditsUsed">$10</div>
                            <div style="font-size: 12px; opacity: 0.8;">3.3% consumed</div>
                        </div>
                        <div style="padding: 24px; background: linear-gradient(135deg, #4facfe, #00f2fe); border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(79,172,254,0.3);">
                            <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px;">Remaining</div>
                            <div style="font-size: 36px; font-weight: 900;" id="creditsRemaining">$290</div>
                            <div style="font-size: 12px; opacity: 0.8;">96.7% available</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="font-weight: 600; font-size: 15px;">Credit Usage Progress</span>
                            <span id="creditPercent" style="font-weight: 700; color: var(--success); font-size: 15px;">3.3%</span>
                        </div>
                        <div style="height: 16px; background: #E5E7EB; border-radius: 8px; overflow: hidden;">
                            <div id="creditProgressBar" style="height: 100%; background: linear-gradient(90deg, #10B981, #3B82F6); width: 3.3%; transition: width 0.5s;"></div>
                        </div>
                    </div>
                </div>

                <!-- Document AI Quota -->
                <div class="card">
                    <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                        <i class="fas fa-file-invoice" style="color: #FF6B6B; font-size: 24px;"></i>
                        Document AI - Invoice Parser
                    </h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 24px;">
                        <div style="padding: 24px; border: 3px solid #DBEAFE; border-radius: 12px; background: linear-gradient(135deg, #EFF6FF, #DBEAFE);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <span style="font-weight: 600;">Free Tier Limit</span>
                                <i class="fas fa-gift" style="color: var(--success); font-size: 20px;"></i>
                            </div>
                            <div style="font-size: 36px; font-weight: 900; color: var(--primary);">1,000</div>
                            <div style="font-size: 13px; color: var(--text-muted);">pages/month</div>
                        </div>
                        <div style="padding: 24px; border: 3px solid #FEF3C7; border-radius: 12px; background: linear-gradient(135deg, #FFFBEB, #FEF3C7);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <span style="font-weight: 600;">Used This Month</span>
                                <i class="fas fa-chart-line" style="color: var(--warning); font-size: 20px;"></i>
                            </div>
                            <div style="font-size: 36px; font-weight: 900; color: var(--warning);" id="docAiUsed">0</div>
                            <div style="font-size: 13px; color: var(--text-muted);">pages processed</div>
                        </div>
                        <div style="padding: 24px; border: 3px solid #D1FAE5; border-radius: 12px; background: linear-gradient(135deg, #ECFDF5, #D1FAE5);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <span style="font-weight: 600;">Remaining Free</span>
                                <i class="fas fa-check-circle" style="color: var(--success); font-size: 20px;"></i>
                            </div>
                            <div style="font-size: 36px; font-weight: 900; color: var(--success);" id="docAiRemaining">1,000</div>
                            <div style="font-size: 13px; color: var(--text-muted);">pages left</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="font-weight: 600;">Monthly Quota Usage</span>
                            <span id="docAiPercent" style="font-weight: 700; color: var(--success);">0%</span>
                        </div>
                        <div style="height: 14px; background: #E5E7EB; border-radius: 7px; overflow: hidden;">
                            <div id="docAiProgressBar" style="height: 100%; background: var(--success); width: 0%; transition: width 0.5s;"></div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="refreshBillingStats()" style="width: 100%;">
                        <i class="fas fa-sync-alt"></i> Refresh Live Stats
                    </button>
                </div>

                <!-- Service Costs Breakdown -->
                <div class="card">
                    <h2 style="margin-bottom: 20px;">
                        <i class="fas fa-chart-pie" style="color: #8B5CF6;"></i> Service Costs Breakdown
                    </h2>
                    <table style="width: 100%;">
                        <thead>
                            <tr style="background: var(--bg-main);">
                                <th style="padding: 14px;">Service</th>
                                <th style="padding: 14px; text-align: center;">Status</th>
                                <th style="padding: 14px; text-align: right;">Usage</th>
                                <th style="padding: 14px; text-align: right;">Cost/Month</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 14px;"><i class="fas fa-server" style="color: var(--primary);"></i> Cloud Run</td>
                                <td style="padding: 14px; text-align: center;"><span class="badge badge-success">Active</span></td>
                                <td style="padding: 14px; text-align: right; color: var(--text-muted);">~5K requests</td>
                                <td style="padding: 14px; text-align: right; font-weight: 700; color: var(--success);">$5-20</td>
                            </tr>
                            <tr>
                                <td style="padding: 14px;"><i class="fas fa-database" style="color: var(--info);"></i> Cloud SQL</td>
                                <td style="padding: 14px; text-align: center;"><span class="badge badge-success">Active</span></td>
                                <td style="padding: 14px; text-align: right; color: var(--text-muted);">PostgreSQL</td>
                                <td style="padding: 14px; text-align: right; font-weight: 700;">$7</td>
                            </tr>
                            <tr>
                                <td style="padding: 14px;"><i class="fas fa-file-invoice" style="color: var(--danger);"></i> Document AI</td>
                                <td style="padding: 14px; text-align: center;"><span class="badge badge-success">Active</span></td>
                                <td style="padding: 14px; text-align: right; color: var(--text-muted);" id="docAiTableUsage">0 / 1,000 free</td>
                                <td style="padding: 14px; text-align: right; font-weight: 700; color: var(--success);" id="docAICost">$0.00</td>
                            </tr>
                            <tr style="background: var(--bg-main); border-top: 3px solid var(--primary);">
                                <td style="padding: 16px;" colspan="3"><strong>Total Monthly Cost</strong></td>
                                <td style="padding: 16px; text-align: right; font-size: 20px; font-weight: 900; color: var(--primary);" id="totalMonthlyCost">$12-27</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Details Modal -->
    <div class="modal-backdrop" id="invoiceModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Invoice Details</h2>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>